---
# ============================================================================
# Server Tasks
# ============================================================================

- name: Include server tasks for Ubuntu/Debian
  ansible.builtin.include_tasks: server-ubuntu.yml
  when:
    - iperf3_server_enabled | default(false)
    - ansible_os_family == "Debian"
  tags:
    - iperf3
    - iperf3-server

- name: Include server tasks for OpenWRT
  ansible.builtin.include_tasks: server-openwrt.yml
  when:
    - iperf3_server_enabled | default(false)
    - ansible_distribution == "OpenWrt" or (ansible_system == "Linux" and ansible_pkg_mgr == "opkg")
  tags:
    - iperf3
    - iperf3-server

# ============================================================================
# Client Tasks
# ============================================================================

- name: Include client tasks for Ubuntu/Debian
  ansible.builtin.include_tasks: client-ubuntu.yml
  when:
    - iperf3_client_enabled | default(false)
    - ansible_os_family == "Debian"
  tags:
    - iperf3
    - iperf3-client

- name: Include client tasks for OpenWRT
  ansible.builtin.include_tasks: client-openwrt.yml
  when:
    - iperf3_client_enabled | default(false)
    - ansible_distribution == "OpenWrt" or (ansible_system == "Linux" and ansible_pkg_mgr == "opkg")
  tags:
    - iperf3
    - iperf3-client
