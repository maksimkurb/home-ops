---
- name: Detect OS and include appropriate tasks
  ansible.builtin.include_tasks: "{{ item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution | lower }}.yml"
        - "{{ ansible_os_family | lower }}.yml"
      skip: true

- name: Include Ubuntu tasks for Debian-based systems
  ansible.builtin.include_tasks: ubuntu.yml
  when: ansible_os_family == "Debian"

- name: Include OpenWRT tasks
  ansible.builtin.include_tasks: openwrt.yml
  when: ansible_distribution == "OpenWrt" or ansible_system == "Linux" and ansible_user_id == "root" and ansible_pkg_mgr == "opkg"
