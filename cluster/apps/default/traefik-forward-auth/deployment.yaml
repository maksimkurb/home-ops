---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: traefik-forward-auth
  namespace: default
  labels:
    app: traefik-forward-auth
spec:
  replicas: 1
  selector:
    matchLabels:
      app: traefik-forward-auth
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: traefik-forward-auth
    spec:
      terminationGracePeriodSeconds: 60
      containers:
        - image: thomseddon/traefik-forward-auth:2
          name: traefik-forward-auth
          ports:
          - containerPort: 4181
            protocol: TCP
          env:
          - name: LOG_LEVEL
            value: "info"
          - name: COOKIE_DOMAIN
            value: "${SECRET_DOMAIN}"
          - name: DEFAULT_PROVIDER
            value: oidc
          - name: PROVIDERS_OIDC_ISSUER_URL
            value: "https://login.${SECRET_DOMAIN}/realms/master"
          - name: PROVIDERS_OIDC_CLIENT_ID
            valueFrom:
              secretKeyRef:
                name: traefik-forward-auth-secrets
                key: clientId
          - name: PROVIDERS_OIDC_CLIENT_SECRET
            valueFrom:
              secretKeyRef:
                name: traefik-forward-auth-secrets
                key: clientSecret
          - name: SECRET
            valueFrom:
              secretKeyRef:
                name: traefik-forward-auth-secrets
                key: encryptionKey
          resources:
            requests:
              memory: 128Mi
            limits:
              memory: 512Mi
              cpu: "500m"