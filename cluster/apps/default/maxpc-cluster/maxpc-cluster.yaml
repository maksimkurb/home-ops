---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRouteTCP
metadata:
  name: external-maxpc-cluster-http
  namespace: default
spec:
  entryPoints:
    - web
  routes:
  - match: HostSNIRegexp(`pc.${SECRET_DOMAIN}`, `{subdomain:[a-z]+}.pc.${SECRET_DOMAIN}`)
    services:
    - name: external-maxpc-cluster
      port: 13080
      terminationDelay: 400

---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRouteTCP
metadata:
  name: external-maxpc-cluster-https
  namespace: default
spec:
  entryPoints:
    - websecure
  routes:
  - match: HostSNIRegexp(`pc.${SECRET_DOMAIN}`, `{subdomain:[a-z]+}.pc.${SECRET_DOMAIN}`)
    services:
    - name: external-maxpc-cluster
      port: 13443
      terminationDelay: 400
  tls:
    passthrough: true

---
apiVersion: v1
kind: Service
metadata:
  name: "external-maxpc-cluster"
  namespace: default
spec:
  selector: {}
  ports:
    - protocol: TCP
      port: 80
      targetPort: 13080
      name: http
    - protocol: TCP
      port: 443
      targetPort: 13443
      name: https

---
apiVersion: "v1"
kind: Endpoints
metadata:
  name: "external-maxpc-cluster"
  namespace: default
subsets: 
  - addresses:
      - ip: "192.168.42.10" 
    ports:
      - port: 13080
        name: "http"
      - port: 13443
        name: "https"

